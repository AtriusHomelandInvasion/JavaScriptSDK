<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>PlayFab API Explorer</title>
    <style type="text/css" media="screen">
        body {
            font-family: "Trebuchet MS", "Helvetica", "Arial",  "Verdana", "sans-serif";
            font-size: 62.5%;
        }
        #editor {
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.3/themes/smoothness/jquery-ui.css">
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <script src="//code.jquery.com/ui/1.11.3/jquery-ui.js"></script>
    <script src="./js/playfab_jsexamples.js"></script>

    <script>
        $(function() {
            $( "input[type=submit], a, button" )
                    .button()
                    .click(function( event ) {
                        runCode();
                        event.preventDefault();
                    });
        });
        function runCode(){
            var editor = ace.edit("editor");
            editor.$blockScrolling = Infinity;
            var iframe = document.getElementById("RunResult");

            iframe.contentWindow.onload = function (){
                editor.getValue();
                return function() { alert("Done."); }
            }
            iframe.contentWindow.runCode(editor.getValue());
        }
        function getParameterByName(name) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                    results = regex.exec(location.search);
            return results === null ? null : decodeURIComponent(results[1].replace(/\+/g, " "));
        }

        var userName = getParameterByName('userName');
        var password = getParameterByName('password');
        var sessionTicket = getParameterByName('sessionTicket');
        var exampleName = getParameterByName('exampleName');

        function populateCode(exampleNameEntry){
            var editor = ace.edit("editor");
            if(exampleNameEntry)
                exampleName = exampleNameEntry;
            else
                exampleName = exampleName ? exampleName : "LoginWithPlayFab";
            editor.setValue(getExample(exampleName,userName,password,sessionTicket));

        }
    </script>
</head>
<body>
<div style = "width:1300px;display:inline-block;">
    <select id="selectExample" style = "display: inline-block;vertical-align: middle;" onmousedown="this.value='';" onchange="populateCode(this.value);">
        <option>Choose an example</option>
    </select>
    <button id="mainButton"  style="vertical-align: middle;">Login</button>
    <span id="currentSession" style="display: inline-block;vertical-align: middle;">
    </span>
</div>
<p></p>
<div style="width: 1300px; height: 300px">

    <div id="editor" style="width: 50%;height: inherit;float: left";>

    </div>
    <div style="width: 50%;height: inherit;float:right;">
        <iframe src="./_runscript/" id="RunResult" name="RunResult" sandbox="allow-scripts allow-same-origin" frameborder="0" style="width: 100%;height: inherit;" ></iframe>

        </iframe>
    </div>
</div>

<script src="js/ace-builds/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/monokai");
    editor.getSession().setMode("ace/mode/javascript");
    populateCode();

    var sessionCheck = setInterval(function(){ retrieveSession() }, 1000);
    function retrieveSession(){
        if(sessionTicket){
            clearInterval(sessionCheck);
            document.getElementById("mainButton").innerHTML = "Run";
            createExampleSelector();
        }
        else{
            sessionTicket = ""+document.getElementById("RunResult").contentWindow.sessionToken;
            document.getElementById("currentSession").innerHTML =  sessionTicket ? "SessionTicket = "+sessionTicket: "Not logged in";

        }
    }
    function createExampleSelector(){
        var select = document.getElementById("selectExample");
        for(var i = 0; i < exampleNames.length; i++) {
            var opt = exampleNames[i];
            var el = document.createElement("option");
            el.textContent = opt;
            el.value = opt;
            select.appendChild(el);
        }
    }

</script>
</body>
</html>